<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Cây tình yêu & Trái tim</title>
<style>
    :root {
        --safe-area-top: env(safe-area-inset-top, 20px);
        --safe-area-bottom: env(safe-area-inset-bottom, 20px);
    }
    
    body {
        background: linear-gradient(to top, #ffb6c1, #fff0f5);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        text-align: center;
        overflow: hidden;
        margin: 0;
        padding-top: var(--safe-area-top);
        padding-bottom: var(--safe-area-bottom);
        min-height: 100vh;
        min-height: -webkit-fill-available;
    }
    
    .tree-container {
        position: relative;
        margin-top: 5vh;
        height: 50vh;
        max-height: 400px;
    }
    
    /* Thân cây */
    .trunk {
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 3.5vmin;
        min-width: 16px;
        max-width: 30px;
        height: 0;
        background: linear-gradient(to top, #8b5a2b, #d2b48c);
        transform: translateX(-50%);
        transition: height 2s ease;
        border-radius: 8px;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        z-index: 1;
    }
    
    /* Cành cây */
    .branch {
        position: absolute;
        background: linear-gradient(to right, #8b5a2b, #d2b48c);
        height: 1.8vmin;
        min-height: 8px;
        width: 0;
        border-radius: 4px;
        transform-origin: left center;
        transition: width 1.5s ease;
        z-index: 1;
        box-shadow: inset 0 0 4px rgba(0,0,0,0.2);
    }
    .branch-left { transform: rotate(-30deg); }
    .branch-right { transform: rotate(30deg); }
    
    /* Lá */
    .leaf {
        position: absolute;
        border-radius: 50%;
        opacity: 0;
        transform: scale(0);
        transition: all 1s ease;
        z-index: 0;
        animation: sway 3s ease-in-out infinite;
    }
    .leaf-green {
        background: radial-gradient(circle at 30% 30%, #8fbc8f, #2e8b57);
        box-shadow: 0 0 6px rgba(46, 139, 87, 0.3);
    }
    .leaf-pink {
        background: radial-gradient(circle at 30% 30%, #ffb6c1, #ff69b4);
        box-shadow: 0 0 6px rgba(255, 105, 180, 0.4);
    }
    @keyframes sway {
        0% { transform: rotate(0deg) scale(1); }
        50% { transform: rotate(3deg) scale(1.05); }
        100% { transform: rotate(0deg) scale(1); }
    }
    
    /* Ảnh chạy từ hai bên */
    .image-left, .image-right {
        position: absolute;
        top: 68%;
        width: 28vmin;
        max-width: 130px;
        min-width: 90px;
        border-radius: 12px;
        filter: drop-shadow(0 3px 6px rgba(255, 105, 180, 0.4));
        opacity: 0;
        transform: scale(0.8);
        transition: all 1.5s ease-out;
        z-index: 2;
    }
    .image-left { left: -200px; }
    .image-right { right: -200px; }
    .show-left {
        left: calc(50% - 35vmin);
        opacity: 1;
        transform: scale(1) rotate(2deg);
    }
    .show-right {
        right: calc(50% - 35vmin);
        opacity: 1;
        transform: scale(1) rotate(-2deg);
    }
    
    /* Canvas trái tim */
    #heartCanvas {
        position: absolute;
        top: 68%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 0;
        z-index: 2;
        animation: heartShow 2s forwards;
        width: 35vmin;
        max-width: 180px;
        height: auto;
    }
    @keyframes heartShow {
        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5);}
        50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1);}
        100% { opacity: 1; transform: translate(-50%, -50%) scale(1);}
    }
    
    /* Bong bóng bay */
    .heart {
        position: absolute;
        bottom: -50px;
        width: 4vmin;
        min-width: 18px;
        max-width: 26px;
        height: 4vmin;
        min-height: 18px;
        max-height: 26px;
        background: red;
        transform: rotate(45deg);
        animation: float 6s linear forwards;
    }
    .heart::before, .heart::after {
        content: '';
        position: absolute;
        width: inherit;
        height: inherit;
        background: inherit;
        border-radius: 50%;
    }
    .heart::before { top: -50%; left: 0; }
    .heart::after { left: -50%; top: 0; }
    @keyframes float {
        0% { transform: translateY(0) rotate(45deg); opacity: 1;}
        100% { transform: translateY(-120vh) rotate(45deg); opacity: 0;}
    }
    
    /* Media Queries cho iPhone */
    @media only screen and (max-width: 430px) and (max-height: 932px) {
        /* Tối ưu cho iPhone 14 Pro và các model tương tự */
        .tree-container {
            margin-top: 3vh;
            height: 45vh;
        }
        
        .image-left, .image-right {
            top: 72%;
            width: 25vmin;
        }
        
        .show-left {
            left: calc(50% - 38vmin);
        }
        
        .show-right {
            right: calc(50% - 38vmin);
        }
        
        #heartCanvas {
            top: 72%;
            width: 40vmin;
        }
        
        .trunk {
            width: 3vmin;
        }
    }
    
    @media only screen and (max-width: 390px) {
        /* Cho các iPhone nhỏ hơn */
        .tree-container {
            height: 40vh;
        }
        
        .image-left, .image-right {
            width: 22vmin;
        }
        
        .show-left {
            left: calc(50% - 40vmin);
        }
        
        .show-right {
            right: calc(50% - 40vmin);
        }
    }
    
    /* Landscape mode */
    @media only screen and (max-height: 430px) and (orientation: landscape) {
        .tree-container {
            margin-top: 2vh;
            height: 70vh;
        }
        
        .image-left, .image-right {
            top: 60%;
            width: 20vmin;
        }
        
        #heartCanvas {
            top: 60%;
            width: 30vmin;
        }
    }
</style>
</head>
<body>

<div class="tree-container">
    <div class="trunk" id="trunk"></div>

    <!-- Cành trái -->
    <div class="branch branch-left" id="branchLeft" style="top:35%; left:calc(50% - 8px);"></div>
    <div class="branch branch-left" id="branchLeftTop" style="top:55%; left:calc(50% - 8px); transform:rotate(-40deg);"></div>

    <!-- Lá cành trái -->
    <div class="leaf leaf-green" id="leafLeft1" style="top:30%; left:calc(50% - 22%); width:5vmin; height:5vmin;"></div>
    <div class="leaf leaf-pink" id="leafLeft2" style="top:25%; left:calc(50% - 16%); width:6vmin; height:6vmin;"></div>
    <div class="leaf leaf-green" id="leafLeft3" style="top:50%; left:calc(50% - 24%); width:5.5vmin; height:5.5vmin;"></div>

    <!-- Cành phải -->
    <div class="branch branch-right" id="branchRight" style="top:40%; left:50%;"></div>
    <div class="branch branch-right" id="branchRightTop" style="top:60%; left:50%; transform:rotate(40deg);"></div>

    <!-- Lá cành phải -->
    <div class="leaf leaf-pink" id="leafRight1" style="top:35%; left:calc(50% + 14%); width:6vmin; height:6vmin;"></div>
    <div class="leaf leaf-green" id="leafRight2" style="top:30%; left:calc(50% + 18%); width:5vmin; height:5vmin;"></div>
    <div class="leaf leaf-pink" id="leafRight3" style="top:55%; left:calc(50% + 20%); width:5.5vmin; height:5.5vmin;"></div>

    <!-- Tán trên -->
    <div class="leaf leaf-green" id="leafTop1" style="top:15%; left:calc(50% - 12%); width:7vmin; height:7vmin;"></div>
    <div class="leaf leaf-pink" id="leafTop2" style="top:10%; left:calc(50% + 4%); width:6.5vmin; height:6.5vmin;"></div>
    <div class="leaf leaf-green" id="leafTop3" style="top:15%; left:calc(50% - 4%); width:8vmin; height:8vmin;"></div>
</div>

<!-- Hai ảnh -->
<img src="image/vaytrang.jpg" class="image-left" id="imgLeft" alt="Ảnh trái">
<img src="image/haihoa.jpg" class="image-right" id="imgRight" alt="Ảnh phải">

<!-- Canvas trái tim -->
<canvas id="heartCanvas" width="200" height="200"></canvas>

<script>
// Vẽ trái tim to
const ctx = document.getElementById('heartCanvas').getContext('2d');
function drawHeart(scale = 1) {
    const canvas = document.getElementById('heartCanvas');
    const size = Math.min(canvas.width, canvas.height);
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.save();
    ctx.translate(canvas.width/2, canvas.height/2);
    ctx.scale(scale, scale);
    ctx.beginPath();
    ctx.moveTo(0, -size*0.2);
    ctx.bezierCurveTo(size*0.25, -size*0.4, size*0.5, -size*0.1, 0, size*0.3);
    ctx.bezierCurveTo(-size*0.5, -size*0.1, -size*0.25, -size*0.4, 0, -size*0.2);
    ctx.closePath();
    ctx.fillStyle = 'red';
    ctx.shadowColor = 'rgba(255,0,0,0.5)';
    ctx.shadowBlur = size*0.1;
    ctx.fill();
    ctx.restore();
}

// Xử lý responsive cho canvas
function resizeCanvas() {
    const canvas = document.getElementById('heartCanvas');
    const size = Math.min(window.innerWidth * 0.3, 180);
    canvas.width = size;
    canvas.height = size;
    drawHeart();
}

// Xử lý sự kiện resize và orientation change
function handleResize() {
    resizeCanvas();
    // Điều chỉnh lại vị trí các phần tử nếu cần
}

window.addEventListener('resize', handleResize);
window.addEventListener('orientationchange', handleResize);

// Khởi tạo ban đầu
resizeCanvas();

let t = 0;
function animateHeart() {
    let scale = 1 + 0.05 * Math.sin(t);
    drawHeart(scale);
    t += 0.1;
    requestAnimationFrame(animateHeart);
}
setTimeout(() => {
    document.getElementById("heartCanvas").style.opacity = "1";
    animateHeart();
}, 8000);

// Cây mọc
setTimeout(() => { document.getElementById("trunk").style.height = "70%"; }, 500);
// Cành trái
setTimeout(() => { document.getElementById("branchLeft").style.width = "18vmin"; }, 2500);
setTimeout(() => { document.getElementById("branchLeftTop").style.width = "15vmin"; }, 3000);
setTimeout(() => {
    ["leafLeft1","leafLeft2","leafLeft3"].forEach(id=>{
        const leaf = document.getElementById(id);
        leaf.style.opacity = "1";
        leaf.style.transform = "scale(1)";
    });
}, 3500);
// Cành phải
setTimeout(() => { document.getElementById("branchRight").style.width = "18vmin"; }, 4000);
setTimeout(() => { document.getElementById("branchRightTop").style.width = "15vmin"; }, 4500);
setTimeout(() => {
    ["leafRight1","leafRight2","leafRight3"].forEach(id=>{
        const leaf = document.getElementById(id);
        leaf.style.opacity = "1";
        leaf.style.transform = "scale(1)";
    });
}, 5000);
// Tán trên
setTimeout(() => {
    ["leafTop1","leafTop2","leafTop3"].forEach(id=>{
        const leaf = document.getElementById(id);
        leaf.style.opacity = "1";
        leaf.style.transform = "scale(1)";
    });
}, 5500);
// Ảnh chạy vào
setTimeout(() => {
    document.getElementById("imgLeft").classList.add("show-left");
    document.getElementById("imgRight").classList.add("show-right");
}, 6000);

// Trái tim bay
function createHeart() {
    const heart = document.createElement("div");
    heart.classList.add("heart");
    heart.style.background = `hsl(${Math.random()*30+340}, 80%, 60%)`;
    heart.style.left = `${Math.random() * window.innerWidth}px`;
    heart.style.animationDuration = `${4 + Math.random() * 3}s`;
    document.body.appendChild(heart);
    setTimeout(() => heart.remove(), 8000);
}
setInterval(createHeart, 500);

// Đảm bảo chiều cao đầy đủ trên iOS
document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);
window.addEventListener('resize', () => {
    document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);
});
</script>

</body>
</html>